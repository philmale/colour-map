{# ============================================ #}
{# COLOURS.JINJA MACRO TEST SUITE              #}
{# ============================================ #}

{%- from 'colour_map.jinja' import 
  random_colour, random_colours,
  name_to_tag, tag_to_name,
  lookup_colour, lookup_colours, find_colour,
  hex2rgb, hex2hsv, hex2hsl, hex2hs, hex2h,
  hex2xyb, rgb2hex, colours
-%}

{# ============================================ #}
{# TEST 1: name_to_tag                         #}
{# Expected: JSON string without spaces/special #}
{# ============================================ #}
TEST 1: name_to_tag
-------------------
Input: "Alice Blue"
Output: {{ name_to_tag("Alice Blue") }}
Expected: "AliceBlue"
Type Check: {{ name_to_tag("Alice Blue") is string }}
JSON Valid: {{ name_to_tag("Alice Blue") | from_json is string }}

Input: "Forest Green"
Output: {{ name_to_tag("Forest Green") }}
Expected: "ForestGreen"

{# ============================================ #}
{# TEST 2: tag_to_name                         #}
{# Expected: JSON string with spaces           #}
{# ============================================ #}

TEST 2: tag_to_name
-------------------
Input: "AliceBlue"
Output: {{ tag_to_name("AliceBlue") }}
Expected: "Alice Blue"
Type Check: {{ tag_to_name("AliceBlue") is string }}
JSON Valid: {{ tag_to_name("AliceBlue") | from_json is string }}

Input: "ForestGreen"
Output: {{ tag_to_name("ForestGreen") }}
Expected: "Forest Green"

{# ============================================ #}
{# TEST 3: random_colour                       #}
{# Expected: JSON string of a colour tag       #}
{# ============================================ #}

TEST 3: random_colour
---------------------
Output (lamp): {{ random_colour("lamp") }}
Type Check: {{ random_colour("lamp") is string }}
JSON Valid: {{ random_colour("lamp") | from_json is string }}
Is Valid Colour: {{ random_colour("lamp") | from_json in colours["lamp"].keys() | list }}

Output (ha): {{ random_colour("ha") }}
Is Valid CSS Colour: {{ random_colour("ha") | from_json in colours["ha"].keys() | list }}

{# ============================================ #}
{# TEST 4: random_colours                      #}
{# Expected: JSON array of colour tags         #}
{# ============================================ #}

TEST 4: random_colours
----------------------
Output (n=1): {{ random_colours(1, "lamp") }}
Type Check: {{ random_colours(1, "lamp") is string }}
JSON Valid: {{ random_colours(1, "lamp") | from_json is list }}
Count Check: {{ random_colours(1, "lamp") | from_json | count == 1 }}

Output (n=5): {{ random_colours(5, "lamp") }}
Count Check: {{ random_colours(5, "lamp") | from_json | count == 5 }}
All Unique: {{ random_colours(5, "lamp") | from_json | unique | list | count == 5 }}

Output (n=10): {{ random_colours(10, "ha") }}
Count Check: {{ random_colours(10, "ha") | from_json | count == 10 }}
All Unique: {{ random_colours(10, "ha") | from_json | unique | list | count == 10 }}

{# Test exhaustion - request more than available #}
{%- set total_f1 = colours["f1"].keys() | list | count -%}
Output (n=all+5, f1 has {{ total_f1 }} colours): {{ random_colours(total_f1 + 5, "f1") | from_json | count }}
Expected: {{ total_f1 }}
Matches: {{ random_colours(total_f1 + 5, "f1") | from_json | count == total_f1 }}

{# ============================================ #}
{# TEST 5: find_colour                         #}
{# Expected: JSON string of matched colour tag #}
{# ============================================ #}

TEST 5: find_colour
-------------------
Input: "AliceBlue" (exact case)
Output: {{ find_colour("AliceBlue", "lamp") }}
Expected: "AliceBlue"
JSON Valid: {{ find_colour("AliceBlue", "lamp") | from_json is string }}

Input: "aliceblue" (lowercase)
Output: {{ find_colour("aliceblue", "lamp") }}
Expected: "AliceBlue"

Input: "Alice Blue" (with spaces)
Output: {{ find_colour("Alice Blue", "lamp") }}
Expected: "AliceBlue"

Input: "ALICE BLUE" (uppercase with spaces)
Output: {{ find_colour("ALICE BLUE", "lamp") }}
Expected: "AliceBlue"

Input: "Red" (CSS colour)
Output: {{ find_colour("Red", "ha") }}
Expected: "Red"

{# ============================================ #}
{# TEST 6: hex2rgb                             #}
{# Expected: JSON array [r, g, b]              #}
{# ============================================ #}

TEST 6: hex2rgb
---------------
Input: "#FF0000" (red)
Output: {{ hex2rgb("#FF0000") }}
Expected: [255, 0, 0]
JSON Valid: {{ hex2rgb("#FF0000") | from_json is list }}
Matches: {{ hex2rgb("#FF0000") | from_json == [255, 0, 0] }}

Input: "#00FF00" (green)
Output: {{ hex2rgb("#00FF00") }}
Expected: [0, 255, 0]
Matches: {{ hex2rgb("#00FF00") | from_json == [0, 255, 0] }}

Input: "#0000FF" (blue)
Output: {{ hex2rgb("#0000FF") }}
Expected: [0, 0, 255]
Matches: {{ hex2rgb("#0000FF") | from_json == [0, 0, 255] }}

Input: "#FFFFFF" (white)
Output: {{ hex2rgb("#FFFFFF") }}
Expected: [255, 255, 255]

Input: "FF0000" (no hash)
Output: {{ hex2rgb("FF0000") }}
Expected: [255, 0, 0]

{# ============================================ #}
{# TEST 7: rgb2hex                             #}
{# Expected: JSON string "#RRGGBB"             #}
{# ============================================ #}

TEST 7: rgb2hex
---------------
Input: [255, 0, 0]
Output: {{ rgb2hex([255, 0, 0]) }}
Expected: "#ff0000"
JSON Valid: {{ rgb2hex([255, 0, 0]) | from_json is string }}
Matches: {{ rgb2hex([255, 0, 0]) | from_json == "#ff0000" }}

Input: [0, 255, 0]
Output: {{ rgb2hex([0, 255, 0]) }}
Expected: "#00ff00"

Input: [0, 0, 255]
Output: {{ rgb2hex([0, 0, 255]) }}
Expected: "#0000ff"

Input: [255, 255, 255]
Output: {{ rgb2hex([255, 255, 255]) }}
Expected: "#ffffff"

{# Round-trip test #}
Round Trip: {{ rgb2hex(hex2rgb("#FF8C00") | from_json) }}
Expected: "#ff8c00"

{# ============================================ #}
{# TEST 8: hex2hsv                             #}
{# Expected: JSON array [h, s, v]              #}
{# ============================================ #}

TEST 8: hex2hsv
---------------
Input: "#FF0000" (pure red)
Output: {{ hex2hsv("#FF0000") }}
Expected: [0.0, 100.0, 100.0]
JSON Valid: {{ hex2hsv("#FF0000") | from_json is list }}

Input: "#00FF00" (pure green)
Output: {{ hex2hsv("#00FF00") }}
Expected: [120.0, 100.0, 100.0]

Input: "#0000FF" (pure blue)
Output: {{ hex2hsv("#0000FF") }}
Expected: [240.0, 100.0, 100.0]

Input: "#FFFFFF" (white)
Output: {{ hex2hsv("#FFFFFF") }}
Expected: [0.0, 0.0, 100.0] (hue undefined for white)

Input: "#808080" (gray)
Output: {{ hex2hsv("#808080") }}
Expected: [0.0, 0.0, ~50.2]

{# ============================================ #}
{# TEST 9: hex2hsl                             #}
{# Expected: JSON array [h, s, l]              #}
{# ============================================ #}

TEST 9: hex2hsl
---------------
Input: "#FF0000" (pure red)
Output: {{ hex2hsl("#FF0000") }}
Expected: [0.0, 100.0, 50.0]
JSON Valid: {{ hex2hsl("#FF0000") | from_json is list }}

Input: "#00FF00" (pure green)
Output: {{ hex2hsl("#00FF00") }}
Expected: [120.0, 100.0, 50.0]

Input: "#0000FF" (pure blue)
Output: {{ hex2hsl("#0000FF") }}
Expected: [240.0, 100.0, 50.0]

{# ============================================ #}
{# TEST 10: hex2hs                             #}
{# Expected: JSON array [h, s]                 #}
{# ============================================ #}

TEST 10: hex2hs
---------------
Input: "#FF0000"
Output: {{ hex2hs("#FF0000") }}
Expected: [0.0, 100.0]
JSON Valid: {{ hex2hs("#FF0000") | from_json is list }}
Length Check: {{ hex2hs("#FF0000") | from_json | count == 2 }}

{# ============================================ #}
{# TEST 11: hex2h                              #}
{# Expected: JSON array [h]                    #}
{# ============================================ #}

TEST 11: hex2h
--------------
Input: "#FF0000"
Output: {{ hex2h("#FF0000") }}
Expected: [0.0]
JSON Valid: {{ hex2h("#FF0000") | from_json is list }}
Length Check: {{ hex2h("#FF0000") | from_json | count == 1 }}

Input: "#00FF00"
Output: {{ hex2h("#00FF00") }}
Expected: [120.0]

{# ============================================ #}
{# TEST 12: hex2xyb                            #}
{# Expected: JSON array [x, y, brightness]     #}
{# ============================================ #}

TEST 12: hex2xyb
----------------
Input: "#FF0000"
Output: {{ hex2xyb("#FF0000") }}
JSON Valid: {{ hex2xyb("#FF0000") | from_json is list }}
Length Check: {{ hex2xyb("#FF0000") | from_json | count == 3 }}

Input: "#FFFFFF"
Output: {{ hex2xyb("#FFFFFF") }}

{# ============================================ #}
{# TEST 13: lookup_colour                      #}
{# Expected: JSON output based on attr         #}
{# ============================================ #}

TEST 13: lookup_colour
----------------------
Input: "AliceBlue", attr="name"
Output: {{ lookup_colour("AliceBlue", "name", "lamp") }}
Expected: "Alice Blue"
JSON Valid: {{ lookup_colour("AliceBlue", "name", "lamp") | from_json is string }}

Input: "AliceBlue", attr="hex"
Output: {{ lookup_colour("AliceBlue", "hex", "lamp") }}
Expected: "#f0f8ff" (lowercase)
JSON Valid: {{ lookup_colour("AliceBlue", "hex", "lamp") | from_json is string }}

Input: "Red", attr="rgb" (HA)
Output: {{ lookup_colour("Red", "rgb", "ha") }}
Expected: [255, 0, 0]
JSON Valid: {{ lookup_colour("Red", "rgb", "ha") | from_json is list }}

Input: "Red", attr="hsv" (HA)
Output: {{ lookup_colour("Red", "hsv", "ha") }}
Expected: [0.0, 100.0, 100.0]
JSON Valid: {{ lookup_colour("Red", "hsv", "ha") | from_json is list }}

Input: "Red", attr="hs" (HA)
Output: {{ lookup_colour("Red", "hs", "ha") }}
Expected: [0.0, 100.0]

Input: "Red", attr="h" (HA)
Output: {{ lookup_colour("Red", "h", "ha") }}
Expected: [0.0]

Input: "Red", attr="hsl" (HA)
Output: {{ lookup_colour("Red", "hsl", "ha") }}
Expected: [0.0, 100.0, 50.0]

Input: "random"
Output: {{ lookup_colour("random", "name", "lamp") }}
Type Check: {{ lookup_colour("random", "name", "lamp") | from_json is string }}

{# ============================================ #}
{# TEST 14: lookup_colours                     #}
{# Expected: JSON array of results             #}
{# ============================================ #}

TEST 14: lookup_colours
-----------------------
Input: "Red, Green, Blue" (string), attr="name"
Output: {{ lookup_colours("Red, Green, Blue", "name", "ha") }}
Expected: ["Red", "Green", "Blue"]
JSON Valid: {{ lookup_colours("Red, Green, Blue", "name", "ha") | from_json is list }}
Count Check: {{ lookup_colours("Red, Green, Blue", "name", "ha") | from_json | count == 3 }}

Input: "Red and Blue" (with 'and')
Output: {{ lookup_colours("Red and Blue", "name", "ha") }}
Count Check: {{ lookup_colours("Red and Blue", "name", "ha") | from_json | count == 2 }}

Input: ["Red", "Green", "Blue"] (list), attr="hex"
Output: {{ lookup_colours(["Red", "Green", "Blue"], "hex", "ha") }}
JSON Valid: {{ lookup_colours(["Red", "Green", "Blue"], "hex", "ha") | from_json is list }}

Input: ["Acadia", "Amber"] (lamp), attr="rgb"
Output: {{ lookup_colours(["Acadia", "Amber"], "rgb", "lamp") }}
JSON Valid: {{ lookup_colours(["Acadia", "Amber"], "rgb", "lamp") | from_json is list }}
Count Check: {{ lookup_colours(["Acadia", "Amber"], "rgb", "lamp") | from_json | count == 2 }}

{# ============================================ #}
{# SUMMARY                                     #}
{# ============================================ #}

===========================================
TEST SUMMARY
===========================================
All macros should return JSON-safe strings.
All outputs should be parseable with | from_json.
All colour lookups should be case-insensitive.
random_colours should return exactly n colours (or max available).
